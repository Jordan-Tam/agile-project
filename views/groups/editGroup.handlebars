{{> header}}
<div class="container-fluid">
	{{!-- <form action="/groups/{{group._id}}" method="get">
		<button type="submit" class="btn btn-primary">
			<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16">
				<path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"/>
			</svg>
		</button>
	</form> --}}
  {{> back-button route=(concat "/groups/" group._id) }}
	<h1>Edit Group</h1>
	{{#if error}}
		<div class="error">{{error}}</div>
	{{/if}}
	<form method="POST" action="/groups/{{group_id}}/edit">
		<div class="custom-card form-floating mb-3">
			<input
				class="form-control"
				placeholder="Group name goes here"
				type="text"
				id="groupName"
				name="groupName"
				value="{{group_name}}"
				required
				minlength="5"
				maxlength="50"
			/>
			<label for="groupName">Group Name</label>
		</div>
		<div class="custom-card form-floating mb-3">
			<textarea
				class="form-control"
				placeholder="Group description goes here"
				id="groupDescription"
				name="groupDescription"
				maxlength="20000"
				required
			>{{group_description}}</textarea>
			<label for="groupDescription">Group Description</label>
		</div>
		<button type="submit" id="btn btn-primary">Update Group</button>
	</form>
</div>

<!-- Confirmation Modal -->
<div id="confirmModal" class="modal">
  <div class="modal-content">
    <span class="close" id="modalClose">&times;</span>
    <h2 id="modalTitle">Confirm Action</h2>
    <p id="modalMessage"></p>
    <div style="margin-top: 20px; text-align: right;">
      <button id="confirmBtn" class="btn btn-primary" style="margin-right: 10px;">Confirm</button>
      <button id="modalCancelBtn" class="btn btn-danger">Cancel</button>
    </div>
  </div>
</div>

{{> custom-card-script initial_width_num=3}}
<script>
  // Store original values when page loads
  const originalName = document.getElementById('groupName').value;
  const originalDescription = document.getElementById('groupDescription').value;
  const form = document.querySelector('form');
  const cancelLink = document.getElementById('cancelLink');
  const modal = document.getElementById('confirmModal');
  const modalMessage = document.getElementById('modalMessage');
  const confirmBtn = document.getElementById('confirmBtn');
  const modalCancelBtn = document.getElementById('modalCancelBtn');
  const modalClose = document.getElementById('modalClose');
  
  let pendingAction = null; // Store the action to execute after confirmation

  // Check if form has been modified
  function hasChanges() {
    const currentName = document.getElementById('groupName').value;
    const currentDescription = document.getElementById('groupDescription').value;
    return currentName !== originalName || currentDescription !== originalDescription;
  }

  // Show confirmation modal
  function showConfirmModal(message, onConfirm) {
    modalMessage.textContent = message;
    pendingAction = onConfirm;
    modal.style.display = 'block';
  }

  // Hide confirmation modal
  function hideConfirmModal() {
    modal.style.display = 'none';
    pendingAction = null;
  }

  // Handle confirm button click
  confirmBtn.addEventListener('click', function() {
    if (pendingAction) {
      pendingAction();
    }
    hideConfirmModal();
  });

  // Handle modal cancel button click
  modalCancelBtn.addEventListener('click', function() {
    hideConfirmModal();
  });

  // Handle close button click
  modalClose.addEventListener('click', function() {
    hideConfirmModal();
  });

  // Close modal when clicking outside
  window.addEventListener('click', function(event) {
    if (event.target === modal) {
      hideConfirmModal();
    }
  });

  // Handle form submission
  form.addEventListener('submit', function(e) {
    if (hasChanges()) {
      e.preventDefault();
      showConfirmModal('Are you sure you want to confirm the changes?', function() {
        // User confirmed - submit the form
        form.submit();
      });
    }
    // If no changes, let form submit normally
  });

  // Handle cancel link click
  cancelLink.addEventListener('click', function(e) {
    if (hasChanges()) {
      e.preventDefault();
      showConfirmModal('Are you sure you want to cancel?', function() {
        // User confirmed - navigate away
        window.location.href = cancelLink.href;
      });
    }
    // If no changes, let navigation proceed normally
  });
</script>

